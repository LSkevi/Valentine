<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>🌸 Yurie's Flower Garden</title>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html{scroll-behavior:smooth;}
    body{
      font-family:'Arial Rounded MT Bold',Arial,sans-serif;
      background:#fce4ec;min-height:100vh;min-height:100dvh;overflow-x:hidden;
    }
    .bg-canvas{
      position:fixed;inset:0;z-index:-2;
      background:linear-gradient(155deg,#fce4ec 0%,#f3e5f5 40%,#e8eaf6 100%);
    }
    .petal{position:fixed;pointer-events:none;z-index:-1;opacity:0;animation:petalDrift linear infinite;}
    @keyframes petalDrift{
      0%{opacity:0;transform:translateY(-30px) rotate(0deg);}
      6%{opacity:.55;}92%{opacity:.35;}
      100%{opacity:0;transform:translateY(105vh) rotate(740deg);}
    }
    #gameScreen{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;padding-bottom:calc(120px + env(safe-area-inset-bottom));}
    .top-bar{
      background:rgba(255,255,255,.93);-webkit-backdrop-filter:blur(14px);backdrop-filter:blur(14px);
      padding:9px 11px;padding-top:calc(9px + env(safe-area-inset-top));
      display:flex;align-items:center;gap:6px;flex-wrap:wrap;
      box-shadow:0 2px 18px rgba(0,0,0,.09);position:sticky;top:0;z-index:20;
    }
    .stat-pill{
      background:linear-gradient(135deg,#fce4ec,#f8bbd0);border-radius:20px;
      padding:6px 11px;font-size:.85em;font-weight:bold;color:#c2185b;
      display:flex;align-items:center;gap:4px;white-space:nowrap;
    }
    .tbtn{
      border:none;border-radius:20px;padding:8px 12px;font-size:.78em;
      font-weight:bold;cursor:pointer;touch-action:manipulation;
      transition:transform .12s;white-space:nowrap;
    }
    .tbtn:active{transform:scale(.92);}
    .tbtn-open   {background:linear-gradient(135deg,#ce93d8,#ab47bc);color:#fff;}
    .tbtn-house  {background:linear-gradient(135deg,#a5d6a7,#43a047);color:#fff;margin-left:auto;}
    .tbtn-shop   {background:linear-gradient(135deg,#ffe082,#ffa000);color:#fff;}
    .tbtn-journal{background:linear-gradient(135deg,#80deea,#00838f);color:#fff;}
    /* journal */
    .journal-prog{text-align:center;font-size:.78em;color:#888;margin-bottom:12px;}
    .journal-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px;padding:4px 0;}
    .jnl-card{border-radius:18px;padding:12px 8px 10px;display:flex;flex-direction:column;align-items:center;gap:5px;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.08);position:relative;}
    .jnl-card.jlocked{background:#f0f0f0;}
    .jnl-svg{width:56px;height:72px;flex-shrink:0;}
    .jnl-fl{width:100%;height:100%;}
    .jnl-svg.jsilhouette{filter:brightness(0);}
    .jnl-name{font-size:.63em;font-weight:bold;color:#333;text-align:center;line-height:1.3;}
    .jnl-name.jlocked{color:#bbb;letter-spacing:.04em;}
    .jnl-sell{font-size:.58em;color:#888;display:flex;align-items:center;gap:2px;}
    .jnl-sell.jhide{visibility:hidden;}
    .jnl-badge{font-size:.52em;border-radius:8px;padding:2px 7px;font-weight:bold;margin-top:1px;}
    .jnl-badge.common   {background:#ffebee;color:#c62828;}
    .jnl-badge.uncommon {background:#e8f5e9;color:#2e7d32;}
    .jnl-badge.rare     {background:#e3f2fd;color:#1565c0;}
    .jnl-badge.legendary{background:#fff8e1;color:#e65100;}
    .garden-header{text-align:center;padding:12px 16px 4px;}
    .garden-header h2{font-size:clamp(1em,4vw,1.45em);color:#c2185b;}
    .garden-header p{font-size:.78em;color:#aaa;margin-top:3px;}
    .water-row{display:flex;align-items:center;justify-content:center;gap:6px;padding:6px 16px 8px;}
    .wdrops{display:flex;gap:3px;}
    .wdrop{width:14px;height:14px;border-radius:50% 50% 50% 50% / 62% 62% 38% 38%;transition:background .4s;}
    .wdrop.full{background:linear-gradient(155deg,#90caf9,#1e88e5);}
    .wdrop.empty{background:#e0e0e0;}
    /* pump */
    .pump-section{display:flex;align-items:center;justify-content:center;gap:16px;padding:4px 16px 10px;}
    .pump-wrap{display:flex;flex-direction:column;align-items:center;cursor:pointer;touch-action:manipulation;user-select:none;-webkit-user-select:none;flex-shrink:0;}
    .pump-svg{width:68px;height:84px;filter:drop-shadow(0 3px 7px rgba(0,0,0,.2));transition:transform .1s;}
    .pump-wrap:active .pump-svg{transform:scale(.93);}
    .pump-handle{transition:transform .14s ease;transform-origin:45px 43px;}
    .pump-handle.pumping{animation:pumpAnim .25s ease;}
    @keyframes pumpAnim{0%{transform:rotate(0)}45%{transform:rotate(22deg)}100%{transform:rotate(0)}}
    .pump-label{font-size:.6em;color:#78909c;font-weight:bold;margin-top:2px;white-space:nowrap;}
    .water-info{display:flex;flex-direction:column;gap:6px;}
    .pump-prog-row{display:flex;align-items:center;gap:6px;}
    .pump-prog-bg{width:86px;height:7px;background:#e0e0e0;border-radius:4px;overflow:hidden;}
    .pump-prog-fill{height:100%;background:linear-gradient(90deg,#90caf9,#1e88e5);border-radius:4px;transition:width .18s ease;}
    .pump-prog-lbl{font-size:.68em;color:#1e88e5;font-weight:bold;white-space:nowrap;min-width:36px;}
    /* coin badge (replaces broken 🪙 emoji) */
    .ic{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;background:linear-gradient(135deg,#ffe082,#ffa000);border-radius:50%;font-size:.68em;font-weight:bold;color:#5d4037;vertical-align:middle;margin-right:2px;flex-shrink:0;line-height:1;}
    .coin-val{font-weight:bold;}
    .garden-grid{
      display:grid;grid-template-columns:repeat(3,1fr);
      gap:10px;padding:8px 11px;max-width:480px;margin:0 auto;width:100%;
    }
    .plot{
      aspect-ratio:80/106;cursor:pointer;position:relative;
      touch-action:manipulation;transition:transform .13s;
      background:transparent;overflow:visible;
    }
    .pot-lbl{
      position:absolute;bottom:5%;left:50%;transform:translateX(-50%);
      background:rgba(30,12,4,.62);color:#fff;font-weight:700;
      font-size:min(2.5vw,10px);padding:2px 8px;border-radius:8px;
      white-space:nowrap;max-width:92%;overflow:hidden;text-overflow:ellipsis;
      pointer-events:none;text-shadow:0 1px 3px rgba(0,0,0,.6);
      letter-spacing:.01em;
    }
    .pot-svg{
      position:absolute;inset:0;width:100%;height:100%;display:block;
      filter:drop-shadow(0 6px 14px rgba(0,0,0,.22));
      transition:filter .25s;
    }
    .plot:active{transform:scale(.93);}
    .plot.bloomed .pot-svg{animation:bloomGlow 2.4s ease-in-out infinite;}
    @keyframes bloomGlow{
      0%,100%{filter:drop-shadow(0 6px 14px rgba(0,0,0,.22));}
      50%{filter:drop-shadow(0 4px 32px rgba(233,30,99,.7)) drop-shadow(0 6px 14px rgba(0,0,0,.22));}
    }
    .plot.watered{animation:waterShake .36s ease;}
    @keyframes waterShake{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
    .seed-tray{
      position:fixed;bottom:0;left:0;right:0;
      background:rgba(255,255,255,.96);-webkit-backdrop-filter:blur(14px);backdrop-filter:blur(14px);
      border-radius:22px 22px 0 0;padding:8px 12px calc(22px + env(safe-area-inset-bottom));
      box-shadow:0 -4px 24px rgba(0,0,0,.12);z-index:15;
    }
    .tray-handle{width:36px;height:4px;background:#e0e0e0;border-radius:2px;margin:0 auto 7px;}
    .tray-title{font-size:.68em;color:#bbb;text-align:center;margin-bottom:7px;font-weight:bold;text-transform:uppercase;letter-spacing:1px;}
    .tray-scroll{display:flex;gap:7px;overflow-x:auto;padding:0 2px 2px;-webkit-overflow-scrolling:touch;scrollbar-width:none;}
    .tray-scroll::-webkit-scrollbar{display:none;}
    .seed-chip{
      display:flex;flex-direction:column;align-items:center;
      border-radius:14px;padding:7px 8px;min-width:58px;max-width:64px;
      position:relative;border:2px solid transparent;flex-shrink:0;cursor:default;
    }
    .seed-chip.common  {background:linear-gradient(135deg,#fce4ec,#f8bbd0);}
    .seed-chip.uncommon{background:linear-gradient(135deg,#f3e5f5,#ce93d8);}
    .seed-chip.rare    {background:linear-gradient(135deg,#e3f2fd,#c5cae9);border-color:#7986cb;animation:rareChip 2s alternate infinite;}
    .seed-chip.legendary{background:linear-gradient(135deg,#fff8e1,#ffe0b2);border-color:#ff8f00;animation:rareChip 2s alternate infinite;}
    @keyframes rareChip{from{box-shadow:0 2px 8px rgba(57,73,171,.3)}to{box-shadow:0 2px 22px rgba(123,31,162,.75)}}
    .chip-svg{width:32px;height:38px;}
    .chip-name{font-size:.5em;color:#555;text-align:center;margin-top:2px;line-height:1.2;}
    .chip-cnt{
      position:absolute;top:-5px;right:-5px;min-width:18px;height:18px;
      background:#e91e63;color:#fff;border-radius:9px;font-size:.5em;
      font-weight:bold;display:flex;align-items:center;justify-content:center;padding:0 3px;
    }
    .tray-empty{text-align:center;color:#bbb;font-size:.82em;padding:8px;}
    .overlay{
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,.5);z-index:100;
      justify-content:center;align-items:flex-end;
      touch-action:manipulation;
    }
    .overlay.on{display:flex;}
    .sheet{
      background:#fff;border-radius:26px 26px 0 0;
      padding:16px 16px calc(36px + env(safe-area-inset-bottom));width:100%;max-width:480px;
      max-height:92vh;max-height:92dvh;overflow-y:auto;-webkit-overflow-scrolling:touch;
      animation:slideUp .28s ease;position:relative;
    }
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .sh-handle{width:36px;height:4px;background:#e0e0e0;border-radius:2px;margin:0 auto 14px;}
    .sh-title{font-size:1.2em;font-weight:bold;color:#c2185b;text-align:center;margin-bottom:14px;}
    .sh-close{
      position:absolute;top:16px;right:16px;width:32px;height:32px;
      border-radius:50%;background:#f5f5f5;border:none;font-size:.95em;
      cursor:pointer;display:flex;align-items:center;justify-content:center;
      touch-action:manipulation;
    }
    .pkt-sel-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:4px 0 8px;}
    .pkt-sel-card{border-radius:20px;cursor:pointer;touch-action:manipulation;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:6px;padding:18px 8px;border:3px solid transparent;transition:transform .13s;}
    .pkt-sel-card:not(.empty):active{transform:scale(.93);}
    .pkt-sel-card.empty{opacity:.38;pointer-events:none;}
    .pkt-sel-card.pkt-common  {background:linear-gradient(155deg,#fce4ec,#f8bbd0);}
    .pkt-sel-card.pkt-uncommon{background:linear-gradient(155deg,#f3e5f5,#e1bee7);}
    .pkt-sel-card.pkt-rare    {background:linear-gradient(155deg,#e3f2fd,#c5cae9);border-color:#7986cb;}
    .pkt-sel-card.pkt-legendary{background:linear-gradient(155deg,#fff8e1,#ffe0b2);border-color:#ff8f00;}
    .pkt-sel-icon{font-size:2.4em;line-height:1;}
    .pkt-sel-name{font-size:.75em;font-weight:bold;color:#555;text-align:center;}
    .pkt-sel-cnt{font-size:.68em;font-weight:bold;color:#fff;background:#e91e63;border-radius:10px;padding:2px 9px;min-width:28px;text-align:center;}
    .pkt-sel-cnt.none{background:#bbb;}
    .pkt-body{display:flex;flex-direction:column;align-items:center;gap:12px;}
    .pkt-card{
      width:110px;height:148px;border-radius:16px;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:8px;border:3px solid rgba(255,255,255,.35);transition:transform .18s;
    }
    .pkt-card.t-common   {background:linear-gradient(155deg,#f48fb1,#e91e63);box-shadow:0 8px 28px rgba(233,30,99,.38);}
    .pkt-card.t-uncommon {background:linear-gradient(155deg,#ce93d8,#7b1fa2);box-shadow:0 8px 28px rgba(123,31,162,.38);}
    .pkt-card.t-rare     {background:linear-gradient(155deg,#5c6bc0,#283593);box-shadow:0 8px 28px rgba(57,73,171,.38);}
    .pkt-card.t-legendary{background:linear-gradient(155deg,#ffb300,#e65100);box-shadow:0 8px 28px rgba(230,81,0,.38);}
    .pkt-card.shaking{animation:pktShake .52s ease;}
    @keyframes pktShake{
      0%,100%{transform:rotate(0)}18%{transform:rotate(-9deg) scale(1.05)}
      36%{transform:rotate(9deg) scale(1.05)}54%{transform:rotate(-6deg)}72%{transform:rotate(6deg)}
    }
    .pkt-icon{font-size:3.2em;}
    .pkt-label{font-size:.62em;color:rgba(255,255,255,.85);font-weight:bold;letter-spacing:1px;}
    .pkt-hint{color:#bbb;font-size:.8em;text-align:center;}
    .pkt-result{display:none;flex-direction:column;align-items:center;gap:11px;}
    .pkt-result.show{display:flex;animation:popIn .48s cubic-bezier(.175,.885,.32,1.275);}
    @keyframes popIn{0%{transform:scale(0);opacity:0}100%{transform:scale(1);opacity:1}}
    .res-flower{width:100px;height:120px;}
    .res-name{font-size:1.3em;font-weight:bold;color:#333;}
    .res-rarity{font-size:.88em;font-weight:bold;padding:5px 16px;border-radius:20px;color:#fff;}
    .res-rarity.common  {background:#9e9e9e;}
    .res-rarity.uncommon{background:linear-gradient(135deg,#ab47bc,#7b1fa2);}
    .res-rarity.rare    {background:linear-gradient(135deg,#3949ab,#7b1fa2);animation:rarePulse 1s alternate infinite;}
    .res-rarity.legendary{background:linear-gradient(135deg,#ff8f00,#e65100);animation:rarePulse 1s alternate infinite;}
    @keyframes rarePulse{from{box-shadow:0 0 8px rgba(57,73,171,.5)}to{box-shadow:0 0 28px rgba(123,31,162,1)}}
    .res-msg{color:#aaa;font-size:.82em;text-align:center;max-width:260px;}
    .btn-collect{
      background:linear-gradient(135deg,#f48fb1,#e91e63);color:#fff;border:none;
      border-radius:50px;padding:13px 36px;font-size:1em;font-weight:bold;
      cursor:pointer;touch-action:manipulation;margin-top:4px;
    }
    .plant-list{display:flex;flex-direction:column;gap:9px;}
    .plant-row{
      display:flex;align-items:center;gap:12px;border-radius:16px;
      padding:11px 14px;cursor:pointer;touch-action:manipulation;
      transition:transform .12s;border:none;width:100%;text-align:left;
    }
    .plant-row:active{transform:scale(.97);}
    .plant-row.common  {background:linear-gradient(135deg,#fce4ec,#f8bbd0);}
    .plant-row.uncommon{background:linear-gradient(135deg,#f3e5f5,#ce93d8);}
    .plant-row.rare    {background:linear-gradient(135deg,#e3f2fd,#c5cae9);animation:rarePulse 2s alternate infinite;}
    .plant-row.legendary{background:linear-gradient(135deg,#fff8e1,#ffe0b2);animation:rarePulse 2s alternate infinite;}
    .pr-svg{width:44px;height:52px;flex-shrink:0;}
    .pr-info{flex:1;min-width:0;}
    .pr-name{font-weight:bold;color:#333;font-size:.9em;}
    .pr-sub{font-size:.72em;color:#888;margin-top:2px;}
    .pr-cnt{font-size:.7em;color:#bbb;}
    .pr-badge{font-size:.68em;font-weight:bold;padding:4px 10px;border-radius:12px;color:#fff;white-space:nowrap;flex-shrink:0;}
    .pr-badge.common  {background:#9e9e9e;}
    .pr-badge.uncommon{background:linear-gradient(135deg,#ab47bc,#7b1fa2);}
    .pr-badge.rare      {background:linear-gradient(135deg,#3949ab,#7b1fa2);}
    .pr-badge.legendary {background:linear-gradient(135deg,#ff8f00,#e65100);}
    .bloom-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center;padding:4px 0 0;}
    .bloom-fl{width:clamp(80px,22vw,110px);height:clamp(96px,26vw,132px);animation:floatBloom 2.5s ease-in-out infinite;flex-shrink:0;}
    @keyframes floatBloom{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-13px) rotate(3deg)}}
    .bloom-title{font-size:clamp(1.1em,5vw,1.4em);font-weight:bold;color:#c2185b;}
    .bloom-sub{color:#888;font-size:.82em;max-width:260px;line-height:1.4;}
    .bloom-reward{
      background:linear-gradient(135deg,#fff9c4,#ffe082);
      border-radius:14px;padding:8px 14px;font-size:.78em;color:#795548;width:100%;font-weight:bold;
    }
    .bloom-btns{display:flex;flex-direction:column;gap:8px;width:100%;}
    .btn-sell{
      background:linear-gradient(135deg,#ffe082,#ffa000);color:#fff;border:none;
      border-radius:50px;padding:14px 26px;font-size:.95em;font-weight:bold;
      cursor:pointer;touch-action:manipulation;width:100%;
    }
    .btn-save{
      background:linear-gradient(135deg,#a5d6a7,#43a047);color:#fff;border:none;
      border-radius:50px;padding:14px 26px;font-size:.95em;font-weight:bold;
      cursor:pointer;touch-action:manipulation;width:100%;
    }
    .gh-stats{display:flex;justify-content:center;gap:10px;margin-bottom:14px;flex-wrap:wrap;}
    .gh-stat{font-size:.78em;color:#888;background:#f5f5f5;padding:6px 12px;border-radius:20px;}
    .gh-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;}
    .gh-card{
      aspect-ratio:.88;border-radius:16px;display:flex;flex-direction:column;
      align-items:center;justify-content:flex-end;padding-bottom:0;
      position:relative;overflow:hidden;cursor:pointer;touch-action:manipulation;
      transition:transform .13s;
    }
    .gh-card:active{transform:scale(.93);}
    .gh-card.common  {background:linear-gradient(to bottom,#c8e6c9,#a5d6a7 38%,#8d6e63 68%,#5d4037);}
    .gh-card.uncommon{background:linear-gradient(to bottom,#f8bbd0,#f48fb1 38%,#8d6e63 68%,#5d4037);}
    .gh-card.rare    {background:linear-gradient(to bottom,#c5cae9,#9fa8da 38%,#8d6e63 68%,#5d4037);animation:rarePulse 2s alternate infinite;}
    .gh-fl{width:100%;flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden;}
    .gh-fl svg{width:100%;height:100%;}
    .gh-name{font-size:.48em;color:rgba(255,255,255,.98);font-weight:bold;text-shadow:0 1px 4px rgba(0,0,0,.65);text-align:center;padding:0 4px 2px;}
    .gh-sell-bar{
      width:100%;background:rgba(0,0,0,.38);backdrop-filter:blur(4px);
      display:flex;align-items:center;justify-content:center;gap:4px;
      padding:5px 4px;font-size:.52em;font-weight:bold;color:#ffe082;
      border-top:1px solid rgba(255,255,255,.12);
    }
    /* gh sell confirm sheet */
    .ghsc-flower{width:80px;height:96px;flex-shrink:0;}
    .ghsc-info{flex:1;min-width:0;}
    .ghsc-name{font-weight:bold;color:#333;font-size:1em;}
    .ghsc-rarity{font-size:.78em;margin-top:3px;}
    .ghsc-row{display:flex;align-items:center;gap:14px;margin-bottom:14px;}
    .ghsc-btns{display:flex;gap:10px;}
    .ghsc-btns .btn-sell{flex:1;padding:13px 10px;}
    .btn-keep{flex:1;background:#f5f5f5;color:#555;border:none;border-radius:50px;
      padding:13px 10px;font-size:.95em;font-weight:bold;cursor:pointer;touch-action:manipulation;}
    .gh-slot-empty{
      border:2px dashed #e0e0e0;border-radius:16px;aspect-ratio:.88;
      display:flex;align-items:center;justify-content:center;color:#ddd;font-size:1.5em;
    }
    .gh-empty{grid-column:1/-1;text-align:center;color:#ccc;padding:28px;font-size:.88em;}
    .shop-item{
      display:flex;align-items:center;justify-content:space-between;
      border-radius:16px;padding:13px 15px;margin-bottom:10px;
    }
    .shop-item.pkt-common  {background:linear-gradient(135deg,#fce4ec,#f8bbd0);}
    .shop-item.pkt-uncommon{background:linear-gradient(135deg,#e8f5e9,#a5d6a7);}
    .shop-item.pkt-rare    {background:linear-gradient(135deg,#e3f2fd,#90caf9);}
    .shop-item.pkt-legendary{background:linear-gradient(135deg,#ede7f6,#ce93d8);border:2px solid #ab47bc;}
    .shop-left{display:flex;align-items:center;gap:10px;}
    .shop-icon{font-size:2em;}
    .shop-name{font-weight:bold;color:#333;font-size:.9em;}
    .shop-detail{font-size:.72em;color:#666;margin-top:2px;}
    .btn-buy{
      background:linear-gradient(135deg,#ffa000,#e65100);color:#fff;border:none;
      border-radius:20px;padding:9px 15px;font-weight:bold;font-size:.8em;
      cursor:pointer;touch-action:manipulation;white-space:nowrap;
    }
    .toast{
      position:fixed;top:68px;left:50%;transform:translateX(-50%) translateY(-14px);
      background:rgba(28,28,28,.88);color:#fff;padding:9px 20px;
      border-radius:22px;font-size:.86em;z-index:400;opacity:0;
      transition:opacity .25s,transform .25s;pointer-events:none;
      white-space:nowrap;max-width:90vw;overflow:hidden;text-overflow:ellipsis;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
    .sparkle{position:fixed;pointer-events:none;z-index:450;font-size:1.4em;animation:spkAnim .9s ease-out forwards;}
    @keyframes spkAnim{
      0%{opacity:1;transform:scale(0) translateY(0);}
      50%{opacity:1;transform:scale(1.5) translateY(-30px);}
      100%{opacity:0;transform:scale(1) translateY(-62px);}
    }
    .confetti-bit{position:fixed;pointer-events:none;z-index:450;border-radius:3px;animation:cfAnim linear forwards;}
    @keyframes cfAnim{
      0%{opacity:1;transform:translateY(0) rotate(0deg);}
      100%{opacity:0;transform:translateY(85vh) rotate(740deg);}
    }
    .splash{position:fixed;pointer-events:none;z-index:420;font-size:1.6em;animation:splashAnim .62s ease-out forwards;}
    @keyframes splashAnim{
      0%{opacity:1;transform:scale(.5) translateY(0);}
      40%{opacity:1;transform:scale(1.4) translateY(-22px);}
      100%{opacity:0;transform:scale(.8) translateY(-44px);}
    }
  </style>
</head>
<body>
<div class="bg-canvas"></div>

<!-- GAME SCREEN -->
<div id="gameScreen">
  <div class="top-bar">
    <div class="stat-pill"><span class="ic">C</span><span id="coinDisp">10</span></div>
    <div class="stat-pill">📦 <span id="pktDisp">3</span></div>
    <button class="tbtn tbtn-open"    onclick="openPktModal()">🎁 Open Packet</button>
    <button class="tbtn tbtn-journal" onclick="openJournalModal()">📖 Journal</button>
    <button class="tbtn tbtn-house"   onclick="openGhModal()">🌿 Greenhouse</button>
    <button class="tbtn tbtn-shop"    onclick="openShopModal()">🛒 Shop</button>
  </div>
  <div class="garden-header">
    <h2>🌸 Yurie's Flower Garden</h2>
    <p>Tap a pot to plant · Tap a plant to water it!</p>
  </div>
  <div class="pump-section">
    <div class="pump-wrap" id="pumpBtn" onclick="pumpClick()">
      <svg class="pump-svg" viewBox="0 0 90 120" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="22" y="110" width="46" height="8" rx="3" fill="#4e342e"/>
        <rect x="37" y="48" width="16" height="64" rx="5" fill="#607d8b"/>
        <rect x="38" y="50" width="6" height="60" rx="3" fill="#78909c" opacity=".4"/>
        <rect x="33" y="42" width="24" height="11" rx="5" fill="#546e7a"/>
        <path d="M39 68 Q22 68 18 80 Q16 89 22 95" stroke="#546e7a" stroke-width="7" fill="none" stroke-linecap="round"/>
        <ellipse cx="22" cy="96" rx="4.5" ry="3.5" fill="#455a64"/>
        <rect x="40" y="34" width="10" height="13" rx="3" fill="#455a64"/>
        <g class="pump-handle" id="pumpHandle">
          <rect x="15" y="39" width="60" height="9" rx="4.5" fill="#78909c"/>
          <rect x="11" y="37" width="8" height="13" rx="4" fill="#90a4ae"/>
          <rect x="71" y="37" width="8" height="13" rx="4" fill="#90a4ae"/>
        </g>
        <circle cx="45" cy="43" r="4.5" fill="#37474f"/>
        <circle cx="45" cy="43" r="2.5" fill="#263238"/>
      </svg>
      <div class="pump-label" id="pumpLabel">Tap to pump!</div>
    </div>
    <div class="water-info">
      <div class="wdrops" id="dropRow"></div>
      <div class="pump-prog-row">
        <div class="pump-prog-bg"><div class="pump-prog-fill" id="pumpProgFill" style="width:0%"></div></div>
        <span class="pump-prog-lbl" id="pumpProgLbl">0/5</span>
      </div>
    </div>
  </div>
  <div class="garden-grid" id="gardenGrid"></div>
  <div class="seed-tray">
    <div class="tray-handle"></div>
    <div class="tray-title">🌱 Your Seeds — tap a pot to plant</div>
    <div class="tray-scroll" id="trayItems"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- PACKET MODAL -->
<div class="overlay" id="pktOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('pktOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title" id="pktTitle">🎁 Open a Packet</div>
    <div id="pktSelector" class="pkt-sel-grid"></div>
    <div id="pktOpenWrap" class="pkt-body" style="display:none">
      <div id="pktCardEl" class="pkt-card">
        <span class="pkt-icon"></span>
        <span class="pkt-label">OPENING…</span>
      </div>
      <p class="pkt-hint" id="pktHint">Something beautiful might be inside… ✨</p>
    </div>
    <div class="pkt-result" id="pktResult">
      <div class="res-flower" id="resFlower"></div>
      <div class="res-name"   id="resName"></div>
      <div class="res-rarity" id="resRarity"></div>
      <div class="res-msg"    id="resMsg"></div>
      <button class="btn-collect" onclick="collectSeed()">Add to Seeds 🌱</button>
    </div>
  </div>
</div>

<!-- PLANT MODAL -->
<div class="overlay" id="plantOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('plantOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title">🌱 Plant a Seed</div>
    <p style="color:#bbb;font-size:.8em;text-align:center;margin-bottom:12px;">Choose which seed to plant here</p>
    <div class="plant-list" id="plantList"></div>
  </div>
</div>

<!-- BLOOM MODAL -->
<div class="overlay" id="bloomOverlay">
  <div class="sheet">
    <div class="sh-handle"></div>
    <div class="bloom-wrap">
      <div class="bloom-fl"    id="bloomFlEl"></div>
      <div class="bloom-title" id="bloomTitle"></div>
      <div class="bloom-sub"   id="bloomSub"></div>
      <div class="bloom-reward">🎁 +1 Seed Packet earned for growing this flower!</div>
      <div class="bloom-btns">
        <button class="btn-sell" id="btnSell">💰 Sell</button>
        <button class="btn-save" onclick="saveFlower()">🏡 Save to Greenhouse</button>
      </div>
    </div>
  </div>
</div>

<!-- GREENHOUSE MODAL -->
<div class="overlay" id="ghOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('ghOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title">🌿 Yurie's Greenhouse</div>
    <div class="gh-stats" id="ghStats"></div>
    <div class="gh-grid"  id="ghGrid"></div>
  </div>
</div>

<!-- GREENHOUSE SELL CONFIRM -->
<div class="overlay" id="ghSellOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('ghSellOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title">🌸 Sell Flower?</div>
    <div class="ghsc-row">
      <div class="ghsc-flower" id="ghscFlower"></div>
      <div class="ghsc-info">
        <div class="ghsc-name" id="ghscName"></div>
        <div class="ghsc-rarity" id="ghscRarity"></div>
        <div style="margin-top:6px;font-size:.82em;color:#888" id="ghscPrice"></div>
      </div>
    </div>
    <div class="ghsc-btns">
      <button class="btn-keep" onclick="closeModal('ghSellOverlay')">Keep 🌿</button>
      <button class="btn-sell" id="ghscSellBtn">💰 Sell</button>
    </div>
  </div>
</div>

<!-- JOURNAL MODAL -->
<div class="overlay" id="journalOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('journalOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title">📖 Flower Journal</div>
    <div class="journal-prog" id="jnlProg"></div>
    <div class="journal-grid" id="jnlGrid"></div>
  </div>
</div>

<!-- SHOP MODAL -->
<div class="overlay" id="shopOverlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeModal('shopOverlay')">✕</button>
    <div class="sh-handle"></div>
    <div class="sh-title">🛒 Shop</div>
    <div class="shop-item pkt-common">
      <div class="shop-left">
        <span class="shop-icon">📦</span>
        <div>
          <div class="shop-name">Common Packet</div>
          <div class="shop-detail">Tulips, daisies, violets, lilies &amp; more — tiny legendary chance</div>
        </div>
      </div>
      <button class="btn-buy" onclick="buyPacket('common')"><span class="ic">C</span> 10</button>
    </div>
    <div class="shop-item pkt-uncommon">
      <div class="shop-left">
        <span class="shop-icon">🌹</span>
        <div>
          <div class="shop-name">Uncommon Packet</div>
          <div class="shop-detail">Roses, poppies, cherries, irises &amp; more — no rarities below uncommon</div>
        </div>
      </div>
      <button class="btn-buy" onclick="buyPacket('uncommon')"><span class="ic">C</span> 30</button>
    </div>
    <div class="shop-item pkt-rare">
      <div class="shop-left">
        <span class="shop-icon">💎</span>
        <div>
          <div class="shop-name">Rare Packet</div>
          <div class="shop-detail">Tiger lilies, orchids, golden iris &amp; more — chance at legendary ✦</div>
        </div>
      </div>
      <button class="btn-buy" onclick="buyPacket('rare')"><span class="ic">C</span> 55</button>
    </div>
    <div class="shop-item pkt-legendary">
      <div class="shop-left">
        <span class="shop-icon">✨</span>
        <div>
          <div class="shop-name">Legendary Packet</div>
          <div class="shop-detail">Blue Rose, Blue Tulip, White Peony, Pink Orchid, Black Rose &amp; more ✦</div>
        </div>
      </div>
      <button class="btn-buy" onclick="buyPacket('legendary')"><span class="ic">C</span> 85</button>
    </div>
  </div>
</div>

<script>
const FLOWERS = {
  // ── Common ──────────────────────────────────────────────────
  pinkTulip:     {name:'Pink Tulip',      kind:'tulip',    rarity:'common',   w:32,petal:'#f06292',stem:'#66bb6a',sell:5 },
  redTulip:      {name:'Red Tulip',       kind:'tulip',    rarity:'common',   w:28,petal:'#e53935',stem:'#66bb6a',sell:6 },
  yellowTulip:   {name:'Yellow Tulip',    kind:'tulip',    rarity:'common',   w:24,petal:'#fdd835',stem:'#66bb6a',sell:6 },
  purpleViolet:  {name:'Purple Violet',   kind:'violet',   rarity:'common',   w:20,petal:'#7e57c2',stem:'#66bb6a',sell:5 },
  blueViolet:    {name:'Blue Violet',     kind:'violet',   rarity:'common',   w:18,petal:'#5c6bc0',stem:'#66bb6a',sell:5 },
  whiteLily:     {name:'White Lily',      kind:'lily',     rarity:'common',   w:16,petal:'#f5f5f5',stem:'#66bb6a',sell:6 },
  purpleIris:    {name:'Purple Iris',     kind:'iris',     rarity:'common',   w:14,petal:'#9c27b0',stem:'#66bb6a',sell:6 },
  yellowDaffodil:{name:'Yellow Daffodil', kind:'daffodil', rarity:'common',   w:18,petal:'#fff176',stem:'#66bb6a',sell:6 },
  whiteDaisy:    {name:'White Daisy',     kind:'daisy',    rarity:'common',   w:22,petal:'#f5f5f5',stem:'#66bb6a',sell:5 },
  yellowDaisy:   {name:'Yellow Daisy',    kind:'daisy',    rarity:'common',   w:18,petal:'#fff176',stem:'#66bb6a',sell:5 },
  pinkDaisy:     {name:'Pink Daisy',      kind:'daisy',    rarity:'common',   w:14,petal:'#f48fb1',stem:'#66bb6a',sell:6 },
  // ── Uncommon ────────────────────────────────────────────────
  sunflower:     {name:'Sunflower',       kind:'sunflower',rarity:'uncommon', w:16,petal:'#fdd835',stem:'#558b2f',sell:18},
  lavender:      {name:'Lavender',        kind:'lavender', rarity:'uncommon', w:14,petal:'#b39ddb',stem:'#7cb342',sell:16},
  whiteTulip:    {name:'White Tulip',     kind:'tulip',    rarity:'uncommon', w:12,petal:'#eceff1',stem:'#66bb6a',sell:12},
  redRose:       {name:'Red Rose',        kind:'rose',     rarity:'uncommon', w:12,petal:'#c62828',stem:'#43a047',sell:18},
  pinkRose:      {name:'Pink Rose',       kind:'rose',     rarity:'uncommon', w:8, petal:'#e91e63',stem:'#43a047',sell:22},
  pinkLily:      {name:'Pink Lily',       kind:'lily',     rarity:'uncommon', w:12,petal:'#f48fb1',stem:'#66bb6a',sell:14},
  blueIris:      {name:'Blue Iris',       kind:'iris',     rarity:'uncommon', w:10,petal:'#1976d2',stem:'#66bb6a',sell:16},
  whiteDaffodil: {name:'White Daffodil',  kind:'daffodil', rarity:'uncommon', w:10,petal:'#f5f5f5',stem:'#66bb6a',sell:15},
  whiteViolet:   {name:'White Violet',    kind:'violet',   rarity:'uncommon', w:8, petal:'#ede7f6',stem:'#66bb6a',sell:14},
  pinkPeony:     {name:'Pink Peony',      kind:'peony',    rarity:'uncommon', w:10,petal:'#f48fb1',stem:'#66bb6a',sell:18},
  redPoppy:      {name:'Red Poppy',       kind:'poppy',    rarity:'uncommon', w:18,petal:'#f44336',stem:'#558b2f',sell:15},
  orangePoppy:   {name:'Orange Poppy',    kind:'poppy',    rarity:'uncommon', w:14,petal:'#ff6d00',stem:'#558b2f',sell:16},
  cherryBlossom: {name:'Cherry Blossom',  kind:'cherry',   rarity:'uncommon', w:16,petal:'#fce4ec',stem:'#795548',sell:20},
  deepCherry:    {name:'Deep Cherry',     kind:'cherry',   rarity:'uncommon', w:10,petal:'#e91e63',stem:'#795548',sell:22},
  yellowRose:    {name:'Yellow Rose',     kind:'rose',     rarity:'uncommon', w:10,petal:'#f9a825',stem:'#43a047',sell:20},
  peachRose:     {name:'Peach Rose',      kind:'rose',     rarity:'uncommon', w:8, petal:'#ffcc80',stem:'#43a047',sell:20},
  purpleRose:    {name:'Purple Rose',     kind:'rose',     rarity:'uncommon', w:6, petal:'#7b1fa2',stem:'#388e3c',sell:25},
  // ── Rare ────────────────────────────────────────────────────
  tigerLily:     {name:'Tiger Lily',      kind:'lily',     rarity:'rare',     w:4, petal:'#ff7043',stem:'#558b2f',sell:60},
  goldenIris:    {name:'Golden Iris',     kind:'iris',     rarity:'rare',     w:4, petal:'#f9a825',stem:'#558b2f',sell:62},
  pinkDaffodil:  {name:'Pink Daffodil',   kind:'daffodil', rarity:'rare',     w:3, petal:'#f8bbd0',stem:'#558b2f',sell:58},
  redPeony:      {name:'Red Peony',       kind:'peony',    rarity:'rare',     w:3, petal:'#e53935',stem:'#558b2f',sell:65},
  purpleOrchid:  {name:'Purple Orchid',   kind:'orchid',   rarity:'rare',     w:3, petal:'#ab47bc',stem:'#558b2f',sell:68},
  blackTulip:    {name:'Black Tulip',     kind:'tulip',    rarity:'rare',     w:2, petal:'#263238',stem:'#1b5e20',sell:70},
  silverRose:    {name:'Silver Rose',     kind:'rose',     rarity:'rare',     w:2, petal:'#90a4ae',stem:'#546e7a',sell:75},
  crystalDaisy:  {name:'Crystal Daisy',   kind:'daisy',    rarity:'rare',     w:2, petal:'#e3f2fd',stem:'#0288d1',sell:65},
  violetPoppy:   {name:'Violet Poppy',    kind:'poppy',    rarity:'rare',     w:2, petal:'#6a1b9a',stem:'#1a237e',sell:70},
  goldenCherry:  {name:'Golden Cherry',   kind:'cherry',   rarity:'rare',     w:1, petal:'#f9a825',stem:'#5d4037',sell:80},
  midnightRose:  {name:'Midnight Rose',   kind:'rose',     rarity:'rare',     w:1, petal:'#37474f',stem:'#212121',sell:90},
  // ── Legendary ───────────────────────────────────────────────
  blueRose:      {name:'Blue Rose',       kind:'rose',     rarity:'legendary',w:3, petal:'#3f51b5',stem:'#388e3c',sell:60},
  blueTulip:     {name:'Blue Tulip',      kind:'tulip',    rarity:'legendary',w:3, petal:'#1565c0',stem:'#1b5e20',sell:65},
  goldenRose:    {name:'Golden Rose',     kind:'rose',     rarity:'legendary',w:2, petal:'#f9a825',stem:'#33691e',sell:75},
  blackRose:     {name:'Black Rose',      kind:'rose',     rarity:'legendary',w:1, petal:'#212121',stem:'#1b5e20',sell:85},
  whitePeony:    {name:'White Peony',     kind:'peony',    rarity:'legendary',w:2, petal:'#fafafa',stem:'#33691e',sell:80},
  pinkOrchid:    {name:'Pink Orchid',     kind:'orchid',   rarity:'legendary',w:2, petal:'#f06292',stem:'#33691e',sell:85},
  blueOrchid:    {name:'Blue Orchid',     kind:'orchid',   rarity:'legendary',w:1, petal:'#42a5f5',stem:'#1b5e20',sell:90},
};
const RARITY_LABEL={common:'Common',uncommon:'Uncommon',rare:'★ Rare',legendary:'✦ Legendary'};
const STAGE_NAMES=['🌰 Seed','🌱 Sprout','🌿 Growing','🌸 Bloomed!'];
const STAGE_WATERS=3,MAX_STAGE=3;

const PKT_COST={common:10,uncommon:30,rare:55,legendary:85};
const PKT_LABEL={common:'Common',uncommon:'Uncommon',rare:'Rare',legendary:'✦ Legendary'};
const PKT_ICON={common:'📦',uncommon:'🌹',rare:'💎',legendary:'✨'};

let G={
  coins:10,pkt:{common:3,uncommon:0,rare:0,legendary:0},seeds:[],seedId:0,
  plots:Array(6).fill(0).map((_,i)=>({id:i,state:'empty',key:null,stage:0,waters:0,rewarded:false})),
  greenhouse:[],water:10,maxWater:10,pumpClicks:0,
  bloomPlot:null,openedKey:null,plantPlot:null,pendingPktType:'common',
  discovered:[],opening:false,
};

const SAVE_KEY='yurieGarden_v1';
function saveG(){
  const s={
    coins:G.coins,pkt:G.pkt,seeds:G.seeds,seedId:G.seedId,
    plots:G.plots,greenhouse:G.greenhouse,water:G.water,
    maxWater:G.maxWater,pumpClicks:G.pumpClicks,discovered:G.discovered,
  };
  try{localStorage.setItem(SAVE_KEY,JSON.stringify(s));}catch(e){}
}
function loadG(){
  try{
    const raw=localStorage.getItem(SAVE_KEY);
    if(!raw) return false;
    const s=JSON.parse(raw);
    Object.assign(G,{
      coins:s.coins??G.coins,
      pkt:s.pkt??G.pkt,
      seeds:s.seeds??[],
      seedId:s.seedId??0,
      plots:s.plots??G.plots,
      greenhouse:s.greenhouse??[],
      water:s.water??G.water,
      maxWater:s.maxWater??G.maxWater,
      pumpClicks:s.pumpClicks??0,
      discovered:s.discovered??[],
    });
    return true;
  }catch(e){return false;}
}

function lighter(hex,a=52){
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return `rgb(${Math.min(255,r+a)},${Math.min(255,g+a)},${Math.min(255,b+a)})`;
}
function darker(hex,a=44){
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return `rgb(${Math.max(0,r-a)},${Math.max(0,g-a)},${Math.max(0,b-a)})`;
}

function flowerSVG(key,stage){
  const f=FLOWERS[key],p=f.petal,S=f.stem;
  const pl=lighter(p),pll=lighter(p,85),pd=darker(p),SD=darker(S,25);
  const rare=f.rarity==='rare';
  if(stage===0) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="30" cy="95" rx="14" ry="4" fill="#6d4c41" opacity=".3"/>
    <path d="M30 93 Q26 78 28 64 Q30 70 32 64 Q34 78 30 93" fill="${S}"/>
    <ellipse cx="30" cy="62" rx="5" ry="4" fill="${SD}" opacity=".9"/>
  </svg>`;
  // SUNFLOWER
  if(f.kind==='sunflower'){
    const ct='#795548',ctD='#4e342e';
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="68" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 83 Q19 76 17 67 Q25 71 30 79" fill="${S}"/><ellipse cx="30" cy="63" rx="6" ry="5" fill="${pd}" opacity=".7"/><ellipse cx="30" cy="61" rx="3.5" ry="2.5" fill="${p}" opacity=".6"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="50" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q16 70 14 60 Q24 65 30 74" fill="${S}"/><path d="M30 78 Q44 70 46 60 Q36 65 30 74" fill="${S}"/><ellipse cx="30" cy="20" rx="5" ry="9" fill="${p}" transform="rotate(0,30,40)" opacity=".8"/><ellipse cx="30" cy="20" rx="5" ry="9" fill="${p}" transform="rotate(90,30,40)" opacity=".8"/><ellipse cx="30" cy="20" rx="5" ry="9" fill="${p}" transform="rotate(180,30,40)" opacity=".8"/><ellipse cx="30" cy="20" rx="5" ry="9" fill="${p}" transform="rotate(270,30,40)" opacity=".8"/><circle cx="30" cy="40" r="9" fill="${ct}"/><circle cx="30" cy="40" r="7" fill="${ctD}"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="45" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q23 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(0,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(45,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(90,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(135,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(180,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(225,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(270,30,33)"/><ellipse cx="30" cy="19" rx="5.5" ry="10" fill="${p}" transform="rotate(315,30,33)"/><circle cx="30" cy="33" r="10" fill="${ct}"/><circle cx="30" cy="33" r="8" fill="${ctD}"/><circle cx="26" cy="29" r="1.5" fill="${ct}" opacity=".6"/><circle cx="31" cy="27" r="1.5" fill="${ct}" opacity=".6"/><circle cx="34" cy="31" r="1.5" fill="${ct}" opacity=".6"/><circle cx="29" cy="35" r="1.5" fill="${ct}" opacity=".6"/></svg>`;
  }
  // LAVENDER
  if(f.kind==='lavender'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="62" stroke="${S}" stroke-width="2" stroke-linecap="round"/><path d="M30 82 Q20 76 18 68 Q25 72 30 79" fill="${S}"/><ellipse cx="28" cy="60" rx="3" ry="4" fill="${p}" opacity=".65"/><ellipse cx="32" cy="57" rx="3" ry="4" fill="${p}" opacity=".65"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 80 Q17 73 15 63 Q24 67 30 75" fill="${S}"/><path d="M30 80 Q43 73 45 63 Q36 67 30 75" fill="${S}"/><line x1="30" y1="66" x2="22" y2="55" stroke="${S}" stroke-width="1.5"/><line x1="30" y1="66" x2="38" y2="55" stroke="${S}" stroke-width="1.5"/><ellipse cx="28" cy="53" rx="3.5" ry="5" fill="${p}" opacity=".8"/><ellipse cx="32" cy="49" rx="3" ry="4.5" fill="${p}" opacity=".8"/><ellipse cx="28" cy="44" rx="3" ry="4" fill="${p}" opacity=".75"/><ellipse cx="32" cy="40" rx="3" ry="4" fill="${p}" opacity=".7"/><ellipse cx="30" cy="35" rx="2.5" ry="3.5" fill="${p}" opacity=".65"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="55" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 70 13 58 Q23 64 30 72" fill="${S}"/><path d="M30 78 Q45 70 47 58 Q37 64 30 72" fill="${S}"/><line x1="30" y1="65" x2="21" y2="52" stroke="${S}" stroke-width="1.5"/><line x1="30" y1="65" x2="39" y2="52" stroke="${S}" stroke-width="1.5"/><ellipse cx="21" cy="50" rx="3" ry="4" fill="${pd}"/><ellipse cx="39" cy="50" rx="3" ry="4" fill="${pd}"/><ellipse cx="27" cy="55" rx="3.5" ry="5" fill="${p}"/><ellipse cx="33" cy="55" rx="3.5" ry="5" fill="${p}"/><ellipse cx="26" cy="47" rx="3" ry="4.5" fill="${p}"/><ellipse cx="34" cy="47" rx="3" ry="4.5" fill="${p}"/><ellipse cx="27" cy="39" rx="3" ry="4" fill="${p}"/><ellipse cx="33" cy="39" rx="3" ry="4" fill="${p}"/><ellipse cx="28" cy="32" rx="2.5" ry="3.5" fill="${p}"/><ellipse cx="32" cy="32" rx="2.5" ry="3.5" fill="${p}"/><ellipse cx="30" cy="25" rx="2.5" ry="3.5" fill="${p}"/><ellipse cx="30" cy="19" rx="2" ry="3" fill="${pd}" opacity=".9"/><ellipse cx="27" cy="54" rx="1.5" ry="1.5" fill="${pll}" opacity=".5"/><ellipse cx="33" cy="46" rx="1.5" ry="1.5" fill="${pll}" opacity=".45"/></svg>`;
  }
  // DAISY
  if(f.kind==='daisy'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="64" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 82 Q19 75 17 66 Q25 70 30 78" fill="${S}"/><ellipse cx="30" cy="59" rx="5" ry="4.5" fill="${pd}" opacity=".7"/><ellipse cx="30" cy="57" rx="3.5" ry="3" fill="${p}" opacity=".65"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 78 Q16 70 14 60 Q24 65 30 72" fill="${S}"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(0,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(45,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(90,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(135,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(180,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(225,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(270,30,44)"/><ellipse cx="30" cy="31" rx="3" ry="7" fill="${p}" opacity=".85" transform="rotate(315,30,44)"/><circle cx="30" cy="44" r="8" fill="#fdd835"/><circle cx="30" cy="44" r="6" fill="#f9a825"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="50" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q23 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="41" r="20" fill="${pll}" opacity=".4"/><circle cx="30" cy="41" r="20" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="11" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(0,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(30,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(60,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(90,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(120,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(150,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(180,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(210,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(240,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(270,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(300,30,41)"/><ellipse cx="30" cy="27" rx="3.5" ry="9" fill="${p}" transform="rotate(330,30,41)"/><circle cx="30" cy="41" r="10" fill="#fdd835"/><circle cx="30" cy="41" r="8" fill="#f9a825"/><circle cx="27" cy="38" r="1.5" fill="#e65100" opacity=".7"/><circle cx="33" cy="38" r="1.5" fill="#e65100" opacity=".7"/><circle cx="30" cy="44" r="1.5" fill="#e65100" opacity=".7"/></svg>`;
  }
  // POPPY
  if(f.kind==='poppy'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="63" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 82 Q19 75 17 65 Q25 70 30 78" fill="${S}"/><ellipse cx="30" cy="56" rx="7" ry="9" fill="${p}" opacity=".82"/><ellipse cx="30" cy="54" rx="4.5" ry="5.5" fill="${pl}" opacity=".55"/><ellipse cx="30" cy="52" rx="2.5" ry="3" fill="${pll}" opacity=".4"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q16 70 14 60 Q24 66 30 72" fill="${S}"/><circle cx="30" cy="30" r="12" fill="${p}" opacity=".88" transform="rotate(0,30,44)"/><circle cx="30" cy="30" r="12" fill="${pd}" opacity=".82" transform="rotate(90,30,44)"/><circle cx="30" cy="30" r="12" fill="${p}" opacity=".88" transform="rotate(180,30,44)"/><circle cx="30" cy="30" r="12" fill="${pd}" opacity=".82" transform="rotate(270,30,44)"/><circle cx="30" cy="44" r="9" fill="#1a1a1a"/><circle cx="30" cy="44" r="7" fill="#263238"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 52 Q23 58 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 52 Q37 58 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="39" r="20" fill="${pll}" opacity=".4"/><circle cx="30" cy="39" r="20" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="9" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<circle cx="30" cy="25" r="14" fill="${p}"/><circle cx="44" cy="39" r="14" fill="${pd}"/><circle cx="30" cy="53" r="14" fill="${p}"/><circle cx="16" cy="39" r="14" fill="${pd}"/><circle cx="30" cy="39" r="10" fill="#1a1a1a"/><circle cx="30" cy="39" r="8" fill="#263238"/><circle cx="28" cy="36" r="1.5" fill="#80cbc4" opacity=".8"/><circle cx="32" cy="36" r="1.5" fill="#80cbc4" opacity=".8"/><circle cx="33" cy="40" r="1.5" fill="#80cbc4" opacity=".8"/><circle cx="27" cy="40" r="1.5" fill="#80cbc4" opacity=".8"/><circle cx="30" cy="34" r="1.5" fill="#80cbc4" opacity=".75"/></svg>`;
  }
  // CHERRY BLOSSOM
  if(f.kind==='cherry'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="65" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 83 Q20 76 18 67 Q26 71 30 80" fill="${S}"/><ellipse cx="30" cy="60" rx="5" ry="5.5" fill="${p}" opacity=".78"/><ellipse cx="30" cy="58" rx="3" ry="3.5" fill="${pll}" opacity=".55"/><circle cx="27" cy="57" r="2" fill="${pd}" opacity=".6"/><circle cx="33" cy="57" r="2" fill="${pd}" opacity=".6"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 78 Q17 71 15 62 Q24 67 30 74" fill="${S}"/><ellipse cx="30" cy="30" rx="5.5" ry="8" fill="${p}" opacity=".88" transform="rotate(0,30,44)"/><ellipse cx="30" cy="30" rx="5.5" ry="8" fill="${pl}" opacity=".82" transform="rotate(72,30,44)"/><ellipse cx="30" cy="30" rx="5.5" ry="8" fill="${p}" opacity=".88" transform="rotate(144,30,44)"/><ellipse cx="30" cy="30" rx="5.5" ry="8" fill="${pl}" opacity=".82" transform="rotate(216,30,44)"/><ellipse cx="30" cy="30" rx="5.5" ry="8" fill="${p}" opacity=".88" transform="rotate(288,30,44)"/><circle cx="30" cy="44" r="6" fill="${pd}"/><circle cx="30" cy="44" r="4" fill="${pll}"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 76 Q14 65 12 52 Q23 58 30 70" fill="${S}"/><path d="M30 76 Q46 65 48 52 Q37 58 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="40" r="21" fill="${pll}" opacity=".35"/><circle cx="30" cy="40" r="21" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="9" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="30" cy="23" rx="7" ry="10" fill="${p}" transform="rotate(0,30,40)"/><ellipse cx="30" cy="23" rx="7" ry="10" fill="${pl}" transform="rotate(72,30,40)"/><ellipse cx="30" cy="23" rx="7" ry="10" fill="${p}" transform="rotate(144,30,40)"/><ellipse cx="30" cy="23" rx="7" ry="10" fill="${pl}" transform="rotate(216,30,40)"/><ellipse cx="30" cy="23" rx="7" ry="10" fill="${p}" transform="rotate(288,30,40)"/><circle cx="30" cy="40" r="8" fill="${pd}"/><circle cx="30" cy="40" r="6" fill="${pll}"/><circle cx="28" cy="37" r="1.5" fill="${pd}" opacity=".8"/><circle cx="32" cy="37" r="1.5" fill="${pd}" opacity=".8"/><circle cx="30" cy="35" r="1.5" fill="${pd}" opacity=".7"/></svg>`;
  }
  // VIOLET
  if(f.kind==='violet'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="66" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><ellipse cx="30" cy="61" rx="4" ry="5" fill="${p}" opacity=".85"/><ellipse cx="30" cy="59" rx="2.5" ry="3" fill="${pll}" opacity=".6"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="60" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 80 Q18 73 16 63 Q24 68 30 75" fill="${S}"/><ellipse cx="30" cy="41" rx="5" ry="8" fill="${p}" opacity=".85" transform="rotate(0,30,50)"/><ellipse cx="30" cy="41" rx="5" ry="8" fill="${pl}" opacity=".8" transform="rotate(72,30,50)"/><ellipse cx="30" cy="41" rx="5" ry="8" fill="${p}" opacity=".85" transform="rotate(144,30,50)"/><circle cx="30" cy="50" r="4" fill="#fdd835"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="58" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 68 13 55 Q23 62 30 72" fill="${S}"/><path d="M30 78 Q45 68 47 55 Q37 62 30 72" fill="${S}"/>${rare?`<circle cx="30" cy="38" r="20" fill="${pll}" opacity=".4"/><circle cx="30" cy="38" r="20" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="9" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="30" cy="23" rx="6" ry="9" fill="${p}" transform="rotate(0,30,38)"/><ellipse cx="30" cy="23" rx="6" ry="9" fill="${p}" transform="rotate(72,30,38)"/><ellipse cx="30" cy="23" rx="6" ry="9" fill="${pl}" transform="rotate(144,30,38)"/><ellipse cx="30" cy="23" rx="6" ry="9" fill="${pl}" transform="rotate(216,30,38)"/><ellipse cx="30" cy="23" rx="6" ry="9" fill="${p}" transform="rotate(288,30,38)"/><circle cx="30" cy="38" r="6" fill="#fdd835"/><circle cx="30" cy="38" r="4" fill="#f9a825"/><ellipse cx="28" cy="36" rx="1" ry="1.5" fill="${pd}" opacity=".7"/><ellipse cx="32" cy="36" rx="1" ry="1.5" fill="${pd}" opacity=".7"/></svg>`;
  }
  // LILY
  if(f.kind==='lily'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="60" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 80 Q19 73 17 63 Q25 68 30 77" fill="${S}"/><path d="M25 62 Q24 52 30 47 Q36 52 35 62 Q32 65 30 66 Q28 65 25 62Z" fill="${p}" opacity=".85"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 68 13 55 Q23 62 30 72" fill="${S}"/><path d="M30 78 Q45 68 47 55 Q37 62 30 72" fill="${S}"/><path d="M21 55 Q18 42 30 37 Q42 42 39 55" fill="${p}" opacity=".88"/><path d="M25 55 Q22 43 30 38 Q38 43 35 55" fill="${pl}" opacity=".3"/><line x1="30" y1="52" x2="24" y2="44" stroke="${pd}" stroke-width="1.2"/><line x1="30" y1="52" x2="36" y2="44" stroke="${pd}" stroke-width="1.2"/><line x1="30" y1="52" x2="30" y2="40" stroke="${pd}" stroke-width="1.2"/><circle cx="24" cy="43" r="1.5" fill="${pd}"/><circle cx="36" cy="43" r="1.5" fill="${pd}"/><circle cx="30" cy="39" r="1.5" fill="${pd}"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q22 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q38 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="35" r="22" fill="${pll}" opacity=".35"/><circle cx="30" cy="35" r="22" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="5" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="30" cy="20" rx="5" ry="12" fill="${p}" transform="rotate(0,30,38)"/><ellipse cx="30" cy="20" rx="5" ry="12" fill="${pl}" transform="rotate(60,30,38)"/><ellipse cx="30" cy="20" rx="5" ry="12" fill="${p}" transform="rotate(120,30,38)"/><ellipse cx="30" cy="20" rx="5" ry="12" fill="${pl}" transform="rotate(180,30,38)"/><ellipse cx="30" cy="20" rx="5" ry="12" fill="${p}" transform="rotate(240,30,38)"/><ellipse cx="30" cy="20" rx="5" ry="12" fill="${pl}" transform="rotate(300,30,38)"/><line x1="30" y1="38" x2="20" y2="26" stroke="${pd}" stroke-width="1.5"/><line x1="30" y1="38" x2="40" y2="26" stroke="${pd}" stroke-width="1.5"/><line x1="30" y1="38" x2="30" y2="22" stroke="${pd}" stroke-width="1.5"/><circle cx="20" cy="25" r="2" fill="${pd}"/><circle cx="40" cy="25" r="2" fill="${pd}"/><circle cx="30" cy="21" r="2" fill="${pd}"/></svg>`;
  }
  // IRIS
  if(f.kind==='iris'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="62" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 80 Q19 73 17 63 Q25 68 30 77" fill="${S}"/><path d="M26 64 Q25 54 30 49 Q35 54 34 64 Q32 67 30 68 Q28 67 26 64Z" fill="${p}" opacity=".85"/><ellipse cx="30" cy="54" rx="4" ry="5" fill="${pl}" opacity=".55"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="55" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 68 13 56 Q23 62 30 72" fill="${S}"/><path d="M17 55 Q22 42 30 43 Q38 42 43 55 Q38 61 30 62 Q22 61 17 55Z" fill="${p}" opacity=".88"/><path d="M22 49 Q27 40 30 43 Q33 40 38 49 Q34 54 30 55 Q26 54 22 49Z" fill="${pl}" opacity=".4"/><ellipse cx="25" cy="43" rx="4" ry="6" fill="${p}" opacity=".8" transform="rotate(-15,25,43)"/><ellipse cx="35" cy="43" rx="4" ry="6" fill="${p}" opacity=".8" transform="rotate(15,35,43)"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q22 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="36" r="22" fill="${pll}" opacity=".35"/><circle cx="30" cy="36" r="22" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="6" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<path d="M12 52 Q18 36 30 40 Q42 36 48 52 Q40 62 30 63 Q20 62 12 52Z" fill="${p}"/><path d="M18 50 Q22 38 30 40 Q38 38 42 50 Q36 57 30 58 Q24 57 18 50Z" fill="${pl}" opacity=".4"/><ellipse cx="20" cy="36" rx="5" ry="9" fill="${p}" transform="rotate(-30,20,36)"/><ellipse cx="40" cy="36" rx="5" ry="9" fill="${p}" transform="rotate(30,40,36)"/><ellipse cx="30" cy="26" rx="5" ry="8" fill="${pl}"/><ellipse cx="28" cy="50" rx="2" ry="3" fill="#fdd835" opacity=".8"/><ellipse cx="32" cy="50" rx="2" ry="3" fill="#fdd835" opacity=".8"/></svg>`;
  }
  // DAFFODIL
  if(f.kind==='daffodil'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="56" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q20 72 18 63 Q25 68 30 76" fill="${S}"/><ellipse cx="30" cy="50" rx="5" ry="8" fill="${p}" opacity=".82" transform="rotate(-20,30,50)"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 68 13 55 Q23 62 30 72" fill="${S}"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(0,30,42)"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(60,30,42)"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(120,30,42)"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(180,30,42)"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(240,30,42)"/><ellipse cx="30" cy="27" rx="5" ry="11" fill="${p}" opacity=".85" transform="rotate(300,30,42)"/><circle cx="30" cy="42" r="9" fill="${pd}"/><circle cx="30" cy="42" r="7" fill="#fdd835" opacity=".9"/><circle cx="30" cy="42" r="5" fill="${p}"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="50" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q23 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="35" r="22" fill="${pll}" opacity=".35"/><circle cx="30" cy="35" r="22" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="5" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(0,30,38)"/><ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(60,30,38)"/><ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(120,30,38)"/><ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(180,30,38)"/><ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(240,30,38)"/><ellipse cx="30" cy="20" rx="5.5" ry="12" fill="${p}" transform="rotate(300,30,38)"/><circle cx="30" cy="38" r="11" fill="${pd}"/><circle cx="30" cy="38" r="9" fill="#fdd835"/><circle cx="30" cy="38" r="6" fill="${darker(p,20)}" opacity=".9"/><circle cx="30" cy="38" r="4" fill="${pll}" opacity=".7"/></svg>`;
  }
  // PEONY
  if(f.kind==='peony'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="62" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 80 Q19 73 17 63 Q25 68 30 77" fill="${S}"/><circle cx="30" cy="55" r="9" fill="${p}" opacity=".88"/><circle cx="30" cy="53" r="6" fill="${pl}" opacity=".65"/><circle cx="30" cy="51" r="3.5" fill="${pll}" opacity=".5"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q15 68 13 55 Q23 62 30 72" fill="${S}"/><path d="M30 78 Q45 68 47 55 Q37 62 30 72" fill="${S}"/><circle cx="30" cy="38" r="16" fill="${p}" opacity=".9"/><circle cx="22" cy="34" r="12" fill="${pl}"/><circle cx="38" cy="34" r="12" fill="${pl}"/><circle cx="30" cy="28" r="12" fill="${p}"/><circle cx="30" cy="40" r="10" fill="${pd}"/><circle cx="30" cy="37" r="7" fill="${pl}"/><circle cx="30" cy="35" r="4" fill="${pll}" opacity=".8"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="50" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q12 64 10 50 Q22 57 30 70" fill="${S}"/><path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="32" r="24" fill="${pll}" opacity=".35"/><circle cx="30" cy="32" r="24" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="2" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<circle cx="30" cy="33" r="19" fill="${p}"/><circle cx="18" cy="27" r="14" fill="${pl}"/><circle cx="42" cy="27" r="14" fill="${pl}"/><circle cx="30" cy="20" r="14" fill="${p}"/><circle cx="18" cy="37" r="12" fill="${pd}"/><circle cx="42" cy="37" r="12" fill="${pd}"/><circle cx="30" cy="43" r="13" fill="${p}"/><circle cx="30" cy="31" r="10" fill="${pl}"/><circle cx="30" cy="28" r="7" fill="${pll}"/><circle cx="28" cy="25" r="1.5" fill="#fdd835" opacity=".9"/><circle cx="32" cy="25" r="1.5" fill="#fdd835" opacity=".9"/><circle cx="30" cy="23" r="1.5" fill="#fdd835" opacity=".9"/></svg>`;
  }
  // ORCHID
  if(f.kind==='orchid'){
    if(stage===1) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="96" x2="30" y2="60" stroke="${S}" stroke-width="2.5" stroke-linecap="round"/><path d="M30 80 Q20 74 18 65 Q25 69 30 77" fill="${S}"/><ellipse cx="30" cy="55" rx="4.5" ry="6.5" fill="${p}" opacity=".85"/><ellipse cx="30" cy="53" rx="2.5" ry="3.5" fill="${pll}" opacity=".6"/></svg>`;
    if(stage===2) return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="54" stroke="${S}" stroke-width="3" stroke-linecap="round"/><path d="M30 78 Q16 70 14 57 Q24 64 30 73" fill="${S}"/><ellipse cx="21" cy="40" rx="5" ry="10" fill="${p}" opacity=".88" transform="rotate(-30,21,40)"/><ellipse cx="39" cy="40" rx="5" ry="10" fill="${p}" opacity=".88" transform="rotate(30,39,40)"/><ellipse cx="30" cy="30" rx="5" ry="9" fill="${pl}" opacity=".85"/><ellipse cx="30" cy="48" rx="7" ry="5" fill="${pd}" opacity=".9"/><ellipse cx="30" cy="48" rx="4" ry="3" fill="${pll}" opacity=".7"/></svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/><line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/><path d="M30 76 Q13 65 11 50 Q23 57 30 70" fill="${S}"/><path d="M30 76 Q47 65 49 50 Q37 57 30 70" fill="${S}"/>${rare?`<circle cx="30" cy="34" r="22" fill="${pll}" opacity=".35"/><circle cx="30" cy="34" r="22" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="4" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}<ellipse cx="16" cy="36" rx="5" ry="12" fill="${p}" transform="rotate(-40,16,36)"/><ellipse cx="44" cy="36" rx="5" ry="12" fill="${p}" transform="rotate(40,44,36)"/><ellipse cx="30" cy="20" rx="4.5" ry="10" fill="${pl}"/><ellipse cx="18" cy="50" rx="5" ry="9" fill="${pl}" transform="rotate(25,18,50)"/><ellipse cx="42" cy="50" rx="5" ry="9" fill="${pl}" transform="rotate(-25,42,50)"/><ellipse cx="30" cy="44" rx="9" ry="7" fill="${pd}"/><ellipse cx="30" cy="44" rx="6" ry="4.5" fill="${pll}"/><ellipse cx="30" cy="43" rx="3" ry="2.5" fill="${p}" opacity=".7"/><circle cx="30" cy="41" r="2" fill="#fdd835" opacity=".9"/></svg>`;
  }
  if(stage===1){
    if(f.kind==='tulip') return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/>
      <line x1="30" y1="96" x2="30" y2="62" stroke="${S}" stroke-width="3" stroke-linecap="round"/>
      <path d="M30 80 Q18 72 16 62 Q24 67 30 77" fill="${S}"/>
      <path d="M25 65 Q24 56 30 51 Q36 56 35 65 Q32 68 30 69 Q28 68 25 65Z" fill="${p}" opacity=".82"/>
    </svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="30" cy="97" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/>
      <line x1="30" y1="96" x2="30" y2="62" stroke="${S}" stroke-width="3" stroke-linecap="round"/>
      <path d="M30 82 Q17 73 15 62 Q23 67 30 78" fill="${S}"/>
      <circle cx="30" cy="53" r="9.5" fill="${pll}" opacity=".8"/>
      <circle cx="30" cy="53" r="7" fill="${p}" opacity=".85"/>
    </svg>`;
  }
  if(stage===2){
    if(f.kind==='tulip') return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/>
      <line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3" stroke-linecap="round"/>
      <path d="M30 78 Q14 67 12 54 Q23 61 30 73" fill="${S}"/>
      <path d="M30 78 Q46 67 48 54 Q37 61 30 73" fill="${S}"/>
      <path d="M22 55 Q21 40 30 35 Q39 40 38 55 Q35 60 30 61 Q25 60 22 55Z" fill="${p}"/>
      <path d="M26 55 Q25 41 30 36 Q35 41 34 55" fill="${pl}" opacity=".3"/>
    </svg>`;
    return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="30" cy="99" rx="13" ry="3.5" fill="#6d4c41" opacity=".28"/>
      <line x1="30" y1="98" x2="30" y2="52" stroke="${S}" stroke-width="3" stroke-linecap="round"/>
      <path d="M30 78 Q14 67 12 53 Q23 60 30 72" fill="${S}"/>
      <path d="M30 78 Q46 67 48 53 Q37 60 30 72" fill="${S}"/>
      <circle cx="30" cy="43" r="14" fill="${pll}" opacity=".7"/>
      <circle cx="22" cy="39" r="10" fill="${pl}"/>
      <circle cx="38" cy="39" r="10" fill="${pl}"/>
      <circle cx="30" cy="36" r="10" fill="${p}"/>
      <circle cx="30" cy="44" r="10" fill="${pd}"/>
    </svg>`;
  }
  if(f.kind==='tulip') return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/>
    <line x1="30" y1="98" x2="30" y2="48" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/>
    <path d="M30 75 Q12 62 10 47 Q22 55 30 68" fill="${S}"/>
    <path d="M30 75 Q48 62 50 47 Q38 55 30 68" fill="${S}"/>
    ${rare?`<circle cx="30" cy="38" r="22" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".65"/><text x="30" y="11" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`:''}
    <path d="M18 49 Q17 30 30 23 Q43 30 42 49 Q38 55 30 57 Q22 55 18 49Z" fill="${p}"/>
    <path d="M23 49 Q22 32 30 25 Q38 32 37 49" fill="${pl}" opacity=".28"/>
    <path d="M24 31 Q27 24 30 23" stroke="rgba(255,255,255,.5)" stroke-width="1.5" stroke-linecap="round"/>
    <path d="M30 23 Q34 24 36 30" stroke="rgba(255,255,255,.38)" stroke-width="1" stroke-linecap="round"/>
    <ellipse cx="30" cy="50" rx="5" ry="4" fill="${pd}" opacity=".35"/>
  </svg>`;
  return `<svg viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="30" cy="99" rx="13" ry="4" fill="#6d4c41" opacity=".28"/>
    <line x1="30" y1="98" x2="30" y2="50" stroke="${S}" stroke-width="3.5" stroke-linecap="round"/>
    <path d="M30 76 Q12 64 10 50 Q23 57 30 70" fill="${S}"/>
    <path d="M30 76 Q48 64 50 50 Q37 57 30 70" fill="${S}"/>
    <path d="M25 65 L18 55" stroke="${S}" stroke-width="2"/>
    ${rare
      ?`<circle cx="30" cy="32" r="17" fill="${pll}" opacity=".55"/>
         <circle cx="30" cy="32" r="17" fill="none" stroke="#7986cb" stroke-width="2" stroke-dasharray="4 3" opacity=".7"/>
         <text x="30" y="12" text-anchor="middle" font-size="7" fill="#5c6bc0" opacity=".9">✦ ✦ ✦</text>`
      :`<circle cx="30" cy="32" r="15" fill="${pll}"/>`
    }
    <circle cx="21" cy="27" r="10" fill="${pl}"/>
    <circle cx="39" cy="27" r="10" fill="${pl}"/>
    <circle cx="30" cy="22" r="10" fill="${p}"/>
    <circle cx="22" cy="36" r="9"  fill="${p}"/>
    <circle cx="38" cy="36" r="9"  fill="${p}"/>
    <circle cx="30" cy="35" r="10" fill="${pd}"/>
    <circle cx="30" cy="31" r="6"  fill="${pd}"/>
    <circle cx="30" cy="29" r="3.5" fill="${darker(p,75)}"/>
  </svg>`;
}

function initPetals(){
  const pool=['🌸','🌷','✿','❀','💮','🌺'];
  for(let i=0;i<14;i++){
    const el=document.createElement('div');
    el.className='petal';
    el.textContent=pool[Math.floor(Math.random()*pool.length)];
    const left=5+Math.random()*90,dur=13+Math.random()*18,delay=Math.random()*20;
    el.style.cssText=`left:${left}%;font-size:${.7+Math.random()*.8}em;animation-duration:${dur}s;animation-delay:-${delay}s;`;
    document.body.appendChild(el);
  }
}

// Start game immediately — no welcome screen
loadG();
initGame();

function initGame(){
  initPetals();
  renderGarden();renderTray();renderDrops();updateHUD();renderPump();
}
function updateHUD(){
  document.getElementById('coinDisp').textContent=G.coins;
  const total=Object.values(G.pkt).reduce((a,b)=>a+b,0);
  document.getElementById('pktDisp').textContent=total;
}

function renderDrops(){
  const row=document.getElementById('dropRow');
  row.innerHTML='';
  for(let i=0;i<G.maxWater;i++){
    const d=document.createElement('div');
    d.className='wdrop '+(i<G.water?'full':'empty');
    row.appendChild(d);
  }
}
function renderPump(){
  const pct=(G.pumpClicks/5)*100;
  const fill=document.getElementById('pumpProgFill');
  const lbl=document.getElementById('pumpProgLbl');
  const plbl=document.getElementById('pumpLabel');
  if(fill) fill.style.width=pct+'%';
  if(lbl)  lbl.textContent=G.pumpClicks+'/5';
  if(plbl) plbl.textContent=G.water>=G.maxWater?'Tank full! 💧':`Pump! (${5-G.pumpClicks} more)`;
}
function pumpClick(){
  if(G.water>=G.maxWater){toast('Watering can is full! 💧',1400);return;}
  G.pumpClicks++;
  // animate handle
  const h=document.getElementById('pumpHandle');
  if(h){h.classList.remove('pumping');void h.offsetWidth;h.classList.add('pumping');}
  // water drip from spout every 2 clicks
  if(G.pumpClicks%2===0){
    const btn=document.getElementById('pumpBtn');
    if(btn){const r=btn.getBoundingClientRect();spawnSplash(r.left+26,r.top+84);}
  }
  if(G.pumpClicks>=5){
    G.pumpClicks=0;
    G.water=Math.min(G.maxWater,G.water+1);
    renderDrops();
    spawnSparkle(window.innerWidth/2,window.innerHeight*.38,'💧');
    toast('+1 water! Keep pumping 💧',1200);
  }
  renderPump();
  saveG();
}

function renderGarden(){
  const grid=document.getElementById('gardenGrid');
  grid.innerHTML='';
  G.plots.forEach((p,i)=>grid.appendChild(buildPlotCard(p,i)));
}
function potCardSVG(p){
  // Terra cotta colours
  const rH='#e8724e',rM='#c9522a',rD='#a83e18';
  const bM='#c24e26',bS='#7a3010';
  const sl='#4e342e',sm='#3e2723',sd='#2a1810';

  // Flower nested into upper 64px of the 103-tall viewBox
  let flPart='';
  if(p.state!=='empty'){
    const stage=p.state==='bloomed'?MAX_STAGE:p.stage;
    const fsvg=flowerSVG(p.key,stage);
    flPart=fsvg.replace(/^<svg /,'<svg x="7" y="0" width="66" height="64" ');
  } else {
    flPart=`<text x="40" y="42" text-anchor="middle" font-size="19"
      fill="rgba(175,100,55,.42)" font-weight="bold">+</text>
      <text x="40" y="54" text-anchor="middle" font-size="6.5"
      fill="rgba(175,100,55,.38)" font-weight="bold">tap to plant</text>`;
  }

  // Progress bar (growing/bloomed states)
  let barEl='';
  if(p.state!=='empty'){
    const totalSteps=MAX_STAGE*STAGE_WATERS;
    const doneSteps=p.stage*STAGE_WATERS+p.waters;
    const barPct=p.state==='bloomed'?100:Math.round(doneSteps/totalSteps*100);
    const barW=Math.round(barPct*50/100);
    barEl=`<rect x="15" y="93.5" width="50" height="3" rx="1.5" fill="rgba(0,0,0,.2)"/>
      <rect x="15" y="93.5" width="${barW}" height="3" rx="1.5" fill="#81c784"/>`;
  }

  const labelEl='';

  // Pips (watering progress dots)
  let pipEls='';
  if(p.state==='growing'){
    for(let w=0;w<STAGE_WATERS;w++){
      const cx=52+w*8,on=w<p.waters;
      pipEls+=`<circle cx="${cx}" cy="9" r="4"
        fill="${on?'#64b5f6':'rgba(255,255,255,.3)'}"
        filter="drop-shadow(0 1px 2px rgba(0,0,0,.4))"/>`;
    }
  }

  // Rare/legendary crown badge
  const _rar=p.state!=='empty'?FLOWERS[p.key].rarity:'';
  const crownEl=_rar==='legendary'
    ?`<rect x="4" y="3" width="22" height="13" rx="3" fill="rgba(230,81,0,.88)"/>
      <text x="15" y="12.5" text-anchor="middle" font-size="6.5"
        fill="#fff" font-weight="bold">\u2726 L</text>`
    :_rar==='rare'
    ?`<rect x="4" y="3" width="22" height="13" rx="3" fill="rgba(25,118,210,.86)"/>
      <text x="15" y="12.5" text-anchor="middle" font-size="6.5"
        fill="#fff" font-weight="bold">\u2605 R</text>`
    :'';

  return `<svg class="pot-svg" viewBox="0 0 80 106"
    fill="none" xmlns="http://www.w3.org/2000/svg">
    ${flPart}
    ${pipEls}
    ${crownEl}
    <!-- Rim top highlight -->
    <rect x="8" y="59" width="64" height="4" rx="2.5" fill="${rH}"/>
    <!-- Rim main body -->
    <rect x="8" y="61" width="64" height="9" rx="3.5" fill="${rM}"/>
    <!-- Rim underside shadow -->
    <rect x="9" y="67" width="62" height="3" rx="2" fill="${rD}" opacity=".5"/>
    <!-- Pot body (trapezoid) -->
    <path d="M13 70 L11 90 Q11 97 19 97 L61 97 Q69 97 69 90 L67 70 Z" fill="${bM}"/>
    <!-- Left shine stripe -->
    <path d="M17 70 L15 87 Q15 92 17.5 93.5"
      stroke="rgba(255,210,170,.28)" stroke-width="3.5"
      fill="none" stroke-linecap="round"/>
    <!-- Right shade stripe -->
    <path d="M63 70 L65 87 Q65 92 62.5 93.5"
      stroke="rgba(0,0,0,.14)" stroke-width="2.5"
      fill="none" stroke-linecap="round"/>
    <!-- Center shine dot -->
    <ellipse cx="24" cy="76" rx="3.5" ry="6" fill="rgba(255,210,170,.16)" transform="rotate(-6,24,76)"/>
    <!-- Dark base band -->
    <path d="M11 89 L11 90 Q11 97 19 97 L61 97 Q69 97 69 90 L69 89 Z" fill="${bS}"/>
    <!-- Pot foot / base ridge -->
    <rect x="14" y="95" width="52" height="4" rx="2" fill="${bS}" opacity=".7"/>
    <!-- Ground shadow ellipse -->
    <ellipse cx="40" cy="103" rx="24" ry="3.5" fill="rgba(0,0,0,.18)"/>
    <!-- Soil surface layers -->
    <ellipse cx="40" cy="66" rx="28" ry="7.5" fill="${sl}"/>
    <ellipse cx="40" cy="64" rx="25" ry="6"   fill="${sm}"/>
    <ellipse cx="40" cy="63" rx="20" ry="4.5" fill="${sd}"/>
    <!-- Soil texture dots -->
    <circle cx="35" cy="63" r="1.5" fill="${sl}" opacity=".6"/>
    <circle cx="44" cy="62" r="1.2" fill="${sl}" opacity=".5"/>
    <circle cx="30" cy="64" r="1"   fill="${sl}" opacity=".4"/>
    ${barEl}
    ${labelEl}
  </svg>`;
}

function buildPlotCard(p,i){
  const div=document.createElement('div');
  div.className='plot'+(p.state==='bloomed'?' bloomed':p.state==='growing'?' has-plant':'');
  div.onclick=()=>clickPlot(i);
  const lbl=p.state==='empty'?''
    :p.state==='bloomed'?'\u2728 '+FLOWERS[p.key].name
    :STAGE_NAMES[p.stage];
  div.innerHTML=potCardSVG(p)+(lbl?`<div class="pot-lbl">${lbl}</div>`:'');
  return div;
}
function clickPlot(i){
  const p=G.plots[i];
  if(p.state==='empty'){
    if(!G.seeds.length){toast('No seeds! Open a packet first 📦',2000);return;}
    openPlantModal(i);
  }else if(p.state==='bloomed'){
    openBloomModal(i);
  }else{
    waterPlot(i);
  }
}
function waterPlot(i){
  if(G.water<=0){toast('No water! Pump more at the well 🚰',2000);return;}
  G.water--;G.plots[i].waters++;renderDrops();
  const tiles=document.querySelectorAll('.plot');
  if(tiles[i]){tiles[i].classList.add('watered');setTimeout(()=>tiles[i].classList.remove('watered'),380);}
  if(tiles[i]){
    const r=tiles[i].getBoundingClientRect();
    spawnSplash(r.left+r.width/2,r.top+r.height/3);
  }
  if(G.plots[i].waters>=STAGE_WATERS){
    G.plots[i].waters=0;G.plots[i].stage++;
    if(G.plots[i].stage>=MAX_STAGE){
      G.plots[i].stage=MAX_STAGE;G.plots[i].state='bloomed';
      if(!G.plots[i].rewarded){G.pkt.common++;G.plots[i].rewarded=true;updateHUD();}
      saveG();
      setTimeout(()=>{renderGarden();confettiBurst();openBloomModal(i);},350);
    }else{
      renderGarden();
      saveG();
      toast(`${STAGE_NAMES[G.plots[i].stage]} — keep watering! 🌿`,1500);
    }
  }else{renderGarden();saveG();}
}

function renderTray(){
  const tray=document.getElementById('trayItems');
  if(!G.seeds.length){tray.innerHTML='<div class="tray-empty">Open a seed packet to start growing! 📦</div>';return;}
  tray.innerHTML='';
  const groups={};
  G.seeds.forEach(s=>{groups[s.key]=(groups[s.key]||0)+1;});
  Object.entries(groups).forEach(([key,cnt])=>{
    const f=FLOWERS[key];
    const chip=document.createElement('div');
    chip.className=`seed-chip ${f.rarity}`;
    chip.innerHTML=`
      <div class="chip-svg">${flowerSVG(key,1)}</div>
      <span class="chip-name">${f.name}</span>
      ${cnt>1?`<span class="chip-cnt">x${cnt}</span>`:''}
    `;
    tray.appendChild(chip);
  });
}

function openPktModal(){
  const total=Object.values(G.pkt).reduce((a,b)=>a+b,0);
  if(!total){toast('No packets! Buy some in the shop 🛒',2000);return;}
  G.openedKey=null;G.opening=false;
  // render selector cards
  const types=['common','uncommon','rare','legendary'];
  document.getElementById('pktSelector').innerHTML=types.map(t=>{
    const cnt=G.pkt[t]||0;
    return `<div class="pkt-sel-card pkt-${t}${cnt?'':' empty'}" onclick="selectPktType('${t}')">
      <span class="pkt-sel-icon">${PKT_ICON[t]}</span>
      <span class="pkt-sel-name">${PKT_LABEL[t]} Packet</span>
      <span class="pkt-sel-cnt${cnt?'':' none'}">×${cnt}</span>
    </div>`;
  }).join('');
  document.getElementById('pktSelector').style.display='';
  document.getElementById('pktOpenWrap').style.display='none';
  document.getElementById('pktResult').classList.remove('show');
  document.getElementById('pktTitle').textContent='🎁 Open a Packet';
  openModal('pktOverlay');
}
function selectPktType(type){
  if(!G.pkt[type]||G.opening) return;
  G.pendingPktType=type;
  G.opening=true;
  document.getElementById('pktSelector').style.display='none';
  document.getElementById('pktTitle').textContent=`${PKT_ICON[type]} Open a ${PKT_LABEL[type]} Packet`;
  const card=document.getElementById('pktCardEl');
  card.className=`pkt-card t-${type}`;
  card.querySelector('.pkt-icon').textContent=PKT_ICON[type];
  document.getElementById('pktOpenWrap').style.display='';
  document.getElementById('pktHint').style.display='';
  setTimeout(()=>{
    card.classList.add('shaking');
    setTimeout(()=>{
      G.pkt[type]--;updateHUD();saveG();
      G.openedKey=weightedRandom(type);
      const f=FLOWERS[G.openedKey];
      document.getElementById('pktOpenWrap').style.display='none';
      document.getElementById('resFlower').innerHTML=`<div style="width:100%;height:100%">${flowerSVG(G.openedKey,MAX_STAGE)}</div>`;
      document.getElementById('resName').textContent=f.name;
      const rl=document.getElementById('resRarity');
      rl.textContent=RARITY_LABEL[f.rarity];
      rl.className=`res-rarity ${f.rarity}`;
      const msgs={
        common:'A lovely flower for your garden! 🌸',
        uncommon:'A beautiful find — how wonderful! 💕',
        rare:`✨ A rare ${f.name}! A stunning bloom, so hard to find! ✨`,
        legendary:`🌟 OH WOW! A legendary ${f.name}! One of the rarest flowers — just like you, one of a kind! 🌟`,
      };
      document.getElementById('resMsg').textContent=msgs[f.rarity]||'A beautiful flower! 🌸';
      document.getElementById('pktResult').classList.add('show');
      G.opening=false;
      if(f.rarity==='legendary') multiSparkle();
      else spawnSparkle(window.innerWidth/2,window.innerHeight*.4,'✨');
    },540);
  },100);
}
function collectSeed(){
  if(!G.openedKey) return;
  if(!G.discovered.includes(G.openedKey)) G.discovered.push(G.openedKey);
  G.seeds.push({id:G.seedId++,key:G.openedKey});G.openedKey=null;
  closeModal('pktOverlay');renderTray();saveG();
  toast('Seed added to your tray! 🌱',1600);
}

function openPlantModal(plotIdx){
  G.plantPlot=plotIdx;
  const list=document.getElementById('plantList');
  list.innerHTML='';
  const groups={};
  G.seeds.forEach(s=>{groups[s.key]=(groups[s.key]||0)+1;});
  Object.entries(groups).forEach(([key,cnt])=>{
    const f=FLOWERS[key];
    const btn=document.createElement('button');
    btn.className=`plant-row ${f.rarity}`;
    btn.innerHTML=`
      <div class="pr-svg">${flowerSVG(key,2)}</div>
      <div class="pr-info">
        <div class="pr-name">${f.name}</div>
        <div class="pr-sub">${RARITY_LABEL[f.rarity]} · sells for <span class="ic">C</span>${f.sell}</div>
        <div class="pr-cnt">x${cnt} in your tray</div>
      </div>
      <span class="pr-badge ${f.rarity}">${RARITY_LABEL[f.rarity]}</span>
    `;
    btn.onclick=()=>plantSeed(key,plotIdx);
    list.appendChild(btn);
  });
  openModal('plantOverlay');
}
function plantSeed(key,plotIdx){
  const idx=G.seeds.findIndex(s=>s.key===key);
  if(idx===-1) return;
  if(!G.discovered.includes(key)) G.discovered.push(key);
  G.seeds.splice(idx,1);
  G.plots[plotIdx]={id:plotIdx,state:'growing',key,stage:0,waters:0,rewarded:false};
  closeModal('plantOverlay');renderGarden();renderTray();saveG();
  toast(`${FLOWERS[key].name} planted! 💧 Water it to grow!`,2000);
}

function openBloomModal(i){
  G.bloomPlot=i;
  const f=FLOWERS[G.plots[i].key];
  document.getElementById('bloomFlEl').innerHTML=flowerSVG(G.plots[i].key,MAX_STAGE);
  document.getElementById('bloomTitle').textContent=`${f.name} is fully bloomed! 🎉`;
  document.getElementById('bloomSub').textContent=
    f.rarity==='rare'
      ?`💙 A legendary ${f.name} — incredibly rare and gorgeous! ✨`
      :f.rarity==='uncommon'
        ?`Your ${f.name.toLowerCase()} is absolutely stunning! 💕`
        :`Beautiful! Your ${f.name.toLowerCase()} is glowing! 🌸`;
  document.getElementById('btnSell').innerHTML=`💰 Sell for <span class="ic">C</span><span class="coin-val">${f.sell}</span>`;
  document.getElementById('btnSell').onclick=sellFlower;
  openModal('bloomOverlay');
}
function sellFlower(){
  if(G.bloomPlot===null) return;
  const key=G.plots[G.bloomPlot].key;
  const f=FLOWERS[key];
  if(!G.discovered.includes(key)) G.discovered.push(key);
  G.coins+=f.sell;clearPlot(G.bloomPlot);closeModal('bloomOverlay');updateHUD();saveG();
  toast(`Sold for ${f.sell} coins! 💰`,2000);
}
function saveFlower(){
  if(G.bloomPlot===null) return;
  const key=G.plots[G.bloomPlot].key;
  if(!G.discovered.includes(key)) G.discovered.push(key);
  G.greenhouse.push({key});clearPlot(G.bloomPlot);closeModal('bloomOverlay');saveG();
  toast(`${FLOWERS[key].name} saved to your greenhouse! 🌿`,2000);
}
function clearPlot(i){
  G.plots[i]={id:i,state:'empty',key:null,stage:0,waters:0,rewarded:false};renderGarden();
}

function openGhModal(){
  const grid=document.getElementById('ghGrid');
  const stats=document.getElementById('ghStats');
  grid.innerHTML='';stats.innerHTML='';
  if(!G.greenhouse.length){
    grid.innerHTML='<div class="gh-empty">No flowers saved yet!<br>Grow some and save them here 🌱</div>';
  }else{
    const total=G.greenhouse.length;
    const rares=G.greenhouse.filter(({key})=>FLOWERS[key].rarity==='rare').length;
    const uniq=new Set(G.greenhouse.map(({key})=>key)).size;
    stats.innerHTML=`
      <span class="gh-stat">🌸 ${total} saved</span>
      <span class="gh-stat">🌈 ${uniq} unique</span>
      ${rares?`<span class="gh-stat">💙 ${rares} legendary</span>`:''}
    `;
    G.greenhouse.forEach(({key},idx)=>{
      const f=FLOWERS[key];
      const card=document.createElement('div');
      card.className=`gh-card ${f.rarity}`;
      card.innerHTML=`
        <div class="gh-fl">${flowerSVG(key,MAX_STAGE)}</div>
        <div class="gh-name">${f.name}</div>
        <div class="gh-sell-bar"><span class="ic" style="width:13px;height:13px;font-size:.7em">C</span>${f.sell} &nbsp;·&nbsp; tap to sell</div>
      `;
      card.onclick=()=>openGhSell(idx);
      grid.appendChild(card);
    });
    const slots=Math.max(9,Math.ceil(G.greenhouse.length/3)*3);
    for(let i=G.greenhouse.length;i<slots;i++){
      const s=document.createElement('div');s.className='gh-slot-empty';s.textContent='＋';grid.appendChild(s);
    }
  }
  openModal('ghOverlay');
}

function openGhSell(idx){
  const {key}=G.greenhouse[idx];
  const f=FLOWERS[key];
  document.getElementById('ghscFlower').innerHTML=flowerSVG(key,MAX_STAGE);
  document.getElementById('ghscName').textContent=f.name;
  const rl=document.getElementById('ghscRarity');
  rl.textContent=RARITY_LABEL[f.rarity]+(f.rarity==='rare'?' ❆❆❆':'');
  rl.style.color=f.rarity==='rare'?'#3949ab':f.rarity==='uncommon'?'#7b1fa2':'#888';
  document.getElementById('ghscPrice').innerHTML=`Sell for &nbsp;<span class="ic" style="width:14px;height:14px">C</span><strong>${f.sell}</strong>`;
  const btn=document.getElementById('ghscSellBtn');
  btn.innerHTML=`💰 Sell for <span class="ic" style="width:13px;height:13px">C</span>${f.sell}`;
  btn.onclick=()=>sellFromGreenhouse(idx);
  openModal('ghSellOverlay');
}

function sellFromGreenhouse(idx){
  const {key}=G.greenhouse[idx];
  const f=FLOWERS[key];
  G.greenhouse.splice(idx,1);
  G.coins+=f.sell;updateHUD();saveG();
  closeModal('ghSellOverlay');
  openGhModal();
  toast(`Sold ${f.name} for ${f.sell} coins! 💰`,2000);
}

function openJournalModal(){
  const order=['pinkTulip','redTulip','yellowTulip','purpleViolet','blueViolet','whiteLily','purpleIris','yellowDaffodil','whiteDaisy','yellowDaisy','pinkDaisy','sunflower','lavender','whiteTulip','redRose','pinkRose','pinkLily','blueIris','whiteDaffodil','whiteViolet','pinkPeony','redPoppy','orangePoppy','cherryBlossom','deepCherry','yellowRose','peachRose','purpleRose','tigerLily','goldenIris','pinkDaffodil','redPeony','purpleOrchid','blackTulip','silverRose','crystalDaisy','violetPoppy','goldenCherry','midnightRose','blueRose','blueTulip','goldenRose','blackRose','whitePeony','pinkOrchid','blueOrchid'];
  const grid=document.getElementById('jnlGrid');
  grid.innerHTML='';
  const unlocked=order.filter(k=>G.discovered.includes(k)).length;
  document.getElementById('jnlProg').textContent=`${unlocked} / ${order.length} flowers discovered`;
  order.forEach(key=>{
    const f=FLOWERS[key];
    const known=G.discovered.includes(key);
    const card=document.createElement('div');
    card.className='jnl-card'+(known?'':' jlocked');
    const svgHtml=flowerSVG(key,3);
    card.innerHTML=`
      <div class="jnl-svg${known?'':' jsilhouette'}">${svgHtml}</div>
      <div class="jnl-name${known?'':' jlocked'}">${known?f.name:'??????'}</div>
      <span class="jnl-badge ${f.rarity}">${RARITY_LABEL[f.rarity]}</span>
      <div class="jnl-sell${known?'':' jhide'}"><span class="ic" style="width:13px;height:13px;font-size:.6em">C</span>${f.sell}</div>
    `;
    grid.appendChild(card);
  });
  openModal('journalOverlay');
}
function openShopModal(){openModal('shopOverlay');}
function buyPacket(type){
  const cost=PKT_COST[type];
  if(G.coins<cost){toast(`Need ${cost} coins for a ${PKT_LABEL[type]} Packet! 💰`,2000);return;}
  G.coins-=cost;G.pkt[type]++;updateHUD();closeModal('shopOverlay');saveG();
  toast(`${PKT_ICON[type]} ${PKT_LABEL[type]} Packet bought!`,1600);
}

// .tbtn already has touch-action:manipulation so iOS fires click immediately (no 300ms delay)
// We use a time guard on backdrop-dismiss to stop any stray click from closing a freshly opened modal
let _modalOpenTime=0;
function openModal(id){
  document.querySelectorAll('.overlay.on').forEach(o=>{if(o.id!==id)o.classList.remove('on');});
  document.getElementById(id).classList.add('on');
  _modalOpenTime=Date.now();
  if(id!=='pktOverlay') G.opening=false;
}
function closeModal(id){document.getElementById(id).classList.remove('on');}
// Backdrop tap closes modal — click only (no touchend), guarded so a tap that opens
// the modal can't immediately close it in the same gesture
document.querySelectorAll('.overlay').forEach(o=>{
  o.addEventListener('click',e=>{
    if(e.target!==o) return;
    if(Date.now()-_modalOpenTime<700) return;
    o.classList.remove('on');
    if(o.id==='pktOverlay') G.opening=false;
  });
});

const PKT_POOLS={
  common:   {pinkTulip:30,redTulip:26,yellowTulip:22,purpleViolet:20,blueViolet:18,whiteLily:16,purpleIris:14,yellowDaffodil:18,whiteDaisy:20,yellowDaisy:16,pinkDaisy:12,sunflower:5,lavender:4,whiteTulip:4,redRose:6,pinkRose:3,redPoppy:3,cherryBlossom:2,blueRose:1,blueTulip:1},
  uncommon: {sunflower:22,lavender:18,whiteTulip:14,redRose:18,pinkRose:12,pinkLily:14,blueIris:12,whiteDaffodil:12,whiteViolet:10,pinkPeony:10,redPoppy:18,orangePoppy:14,cherryBlossom:16,deepCherry:10,yellowRose:10,peachRose:8,purpleRose:6,blueRose:3,blueTulip:3},
  rare:     {sunflower:8,lavender:6,redRose:12,pinkRose:10,tigerLily:12,goldenIris:10,pinkDaffodil:10,redPeony:10,purpleOrchid:10,blueRose:16,blueTulip:16,goldenRose:12,blackRose:6,blackTulip:12,silverRose:10,crystalDaisy:10,violetPoppy:10,goldenCherry:8,midnightRose:6},
  legendary:{blueRose:25,blueTulip:25,goldenRose:20,blackRose:12,whitePeony:10,pinkOrchid:8,blueOrchid:6,blackTulip:15,silverRose:12,crystalDaisy:10,violetPoppy:10,goldenCherry:8,midnightRose:6},
};
function weightedRandom(type='common'){
  const pool=PKT_POOLS[type]||PKT_POOLS.common;
  const keys=Object.keys(pool);
  const total=keys.reduce((s,k)=>s+pool[k],0);
  let r=Math.random()*total;
  for(const k of keys){r-=pool[k];if(r<=0)return k;}
  return keys.at(-1);
}

let toastTimer;
function toast(msg,ms=2000){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  clearTimeout(toastTimer);toastTimer=setTimeout(()=>el.classList.remove('show'),ms);
}
function spawnSparkle(x,y,e='✨'){
  const el=document.createElement('div');el.className='sparkle';el.textContent=e;
  el.style.cssText=`left:${x}px;top:${y}px`;document.body.appendChild(el);setTimeout(()=>el.remove(),950);
}
function spawnSplash(x,y){
  const el=document.createElement('div');el.className='splash';el.textContent='💧';
  el.style.cssText=`left:${x}px;top:${y}px`;document.body.appendChild(el);setTimeout(()=>el.remove(),680);
}
function multiSparkle(){
  const pool=['✨','💙','⭐','💫','🌟','💎','🔮','🫧'];
  for(let i=0;i<16;i++) setTimeout(()=>{
    spawnSparkle(window.innerWidth*(.08+Math.random()*.84),window.innerHeight*(.1+Math.random()*.7),pool[Math.floor(Math.random()*pool.length)]);
  },i*90);
}
function confettiBurst(){
  const colors=['#f48fb1','#ce93d8','#90caf9','#a5d6a7','#ffe082','#e91e63','#f9a825'];
  for(let i=0;i<30;i++){
    const el=document.createElement('div');el.className='confetti-bit';
    const x=window.innerWidth*(.1+Math.random()*.8);
    const y=window.innerHeight*(.15+Math.random()*.35);
    const sz=6+Math.random()*9,dur=1.2+Math.random()*1.5;
    el.style.cssText=`left:${x}px;top:${y}px;width:${sz}px;height:${sz+2}px;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${dur}s;`;
    document.body.appendChild(el);setTimeout(()=>el.remove(),dur*1000+100);
  }
}
</script>
</body>
</html>
